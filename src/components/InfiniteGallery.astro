---
const images = [
  "/img/project-1.jpg",
  "/img/project-2.jpg",
  "/img/project-3.jpg",
  "/img/project-4.jpg",
  "/img/project-5.jpg",
  "/img/project-6.jpg",
  "/img/project-7.jpg",
  "/img/project-8.jpg",
];
---

<section class="infinite-gallery">
  <!-- Minimalist arrow buttons for manual control -->
  <button
    class="gallery-arrow gallery-arrow-left"
    aria-label="Previous"
    id="galleryLeft"
  >
    <svg
      width="18"
      height="18"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
    >
      <path d="M15 18l-6-6 6-6"></path>
    </svg>
  </button>

  <div class="gallery-track" id="galleryTrack">
    {/* Original images */}
    {
      images.map((img) => (
        <div class="gallery-item">
          <img src={img} alt="Gallery" loading="lazy" />
        </div>
      ))
    }
    {/* Duplicated for seamless infinite loop */}
    {
      images.map((img) => (
        <div class="gallery-item">
          <img src={img} alt="Gallery" loading="lazy" />
        </div>
      ))
    }
  </div>

  <button
    class="gallery-arrow gallery-arrow-right"
    aria-label="Next"
    id="galleryRight"
  >
    <svg
      width="18"
      height="18"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="1.5"
    >
      <path d="M9 18l6-6-6-6"></path>
    </svg>
  </button>
</section>

<style lang="scss">
  .infinite-gallery {
    overflow: hidden;
    padding: 0;
    background: #000;
    position: relative;
  }

  .gallery-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
    width: 34px;
    height: 34px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.25);
    border-radius: 50%;
    color: #fff;
    cursor: pointer;
    transition: all 0.3s ease;
    -webkit-tap-highlight-color: transparent;

    &:hover,
    &:focus {
      background: rgba(255, 255, 255, 0.25);
      outline: none;
    }
  }

  .gallery-arrow-left {
    left: 10px;
  }
  .gallery-arrow-right {
    right: 10px;
  }

  .gallery-track {
    display: flex;
    width: calc(450px * 16); /* 8 images Ã— 2 (duplicated) */
    animation: smoothScroll 50s linear infinite;

    &:hover {
      animation-play-state: paused;
    }

    &.paused {
      animation-play-state: paused;
    }

    &.reverse {
      animation-direction: reverse;
    }
  }

  .gallery-item {
    width: 450px;
    height: 65vh;
    flex-shrink: 0;
    position: relative;
    overflow: hidden;

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition:
        transform 0.5s ease,
        filter 0.5s ease;
      filter: grayscale(10%);
    }

    &:hover img {
      transform: scale(1.03);
      filter: grayscale(0%);
    }

    &::after {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.08),
        transparent,
        rgba(0, 0, 0, 0.08)
      );
      pointer-events: none;
    }
  }

  /* Smooth continuous scroll animation */
  @keyframes smoothScroll {
    0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(
        calc(-450px * 8)
      ); /* Scroll through original 8 images */
    }
  }

  @media (max-width: 768px) {
    .gallery-item {
      width: 75vw;
      height: 45vh;
    }

    .gallery-track {
      width: calc(75vw * 16);
    }

    @keyframes smoothScroll {
      100% {
        transform: translateX(calc(-75vw * 8));
      }
    }

    .gallery-arrow {
      width: 30px;
      height: 30px;
      svg {
        width: 14px;
        height: 14px;
      }
    }

    .gallery-arrow-left {
      left: 6px;
    }
    .gallery-arrow-right {
      right: 6px;
    }
  }
</style>

<script>
  const track = document.getElementById("galleryTrack");
  const leftBtn = document.getElementById("galleryLeft");
  const rightBtn = document.getElementById("galleryRight");

  if (track && leftBtn && rightBtn) {
    let isPaused = false;
    let isReversed = false;

    // Left arrow - reverse direction temporarily
    leftBtn.addEventListener("click", () => {
      track.classList.add("reverse");
      isReversed = true;

      // After 3 seconds, go back to normal direction
      setTimeout(() => {
        track.classList.remove("reverse");
        isReversed = false;
      }, 3000);
    });

    // Right arrow - speed up temporarily or resume if paused
    rightBtn.addEventListener("click", () => {
      if (isReversed) {
        track.classList.remove("reverse");
        isReversed = false;
      }

      // Speed up animation temporarily
      track.style.animationDuration = "15s";
      setTimeout(() => {
        track.style.animationDuration = "50s";
      }, 2000);
    });

    // Touch support - pause on touch
    track.addEventListener(
      "touchstart",
      () => {
        track.classList.add("paused");
      },
      { passive: true },
    );

    track.addEventListener(
      "touchend",
      () => {
        setTimeout(() => {
          track.classList.remove("paused");
        }, 1000);
      },
      { passive: true },
    );
  }
</script>
